<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Event-Planner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="admin.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header>
        <input type="checkbox" id="toggler">
        <label for="toggler" class="fa fa-bars"></label>
        <a href="#" class="logo">Dream<span>scape</span></a>
        <nav class="navbar">
            <a href="#home">Home</a>
            <a href="#dashboard">Dashboard</a>
            <button onclick="disp()" class="mo"><img src="./images/profilenav.png" alt="profile"></button>
        </nav>
    </header>

    <section class="home" id="home">
        <div class="content">
            <h3>Welcome to Chandru</h3>
            <span>Manage Your Events Efficiently</span>
            <p>Navigate through the dashboard to manage events, check reviews, and update profiles.</p>
            <a href="#dashboard" class="btn">Go to Dashboard</a>
        </div>
    </section>

    <section class="dashboard" id="dashboard">
        <h1 class="heading">Admin <span>Dashboard</span></h1>
        <div class="box-container">
            <div class="box">
                <div class="content">
                    <h3>Completed Events</h3>
                    <p>View all the events that have been successfully completed.</p>
                    <a href="#" class="btn" id="viewCompletedEvents">View Completed Events</a>
                </div>
            </div>
            <div class="box">
                <div class="content">
                    <h3>Upcoming Events</h3>
                    <p>Check out the upcoming events that are scheduled.</p>
                    <a href="#" class="btn" id="viewUpcomingEvents">View Upcoming Events</a>
                </div>
            </div>
            <div class="box">
                <div class="content">
                    <h3>Availabilities</h3>
                    <p>Update and manage your availability for event bookings.</p>
                    <a href="#" class="btn" onclick="showAvailabilitiesPopup()">Update Availabilities</a>
                </div>
            </div>
        </div>
          
        <div id="availabilitiesModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeAvailabilitiesPopup()">&times;</span>
                <h2>Update Availabilities</h2>
                <form action="/addnew" method="post">
                    <label for="availability">Select Availability:</label>
                    <select id="availability" name="availability" onchange="handleAvailabilityChange()">
                        <option value="venue">Venue</option>
                        <option value="studio">Studio</option>
                    </select>
                    <div id="common-fields">
                        <label for="name">Name:</label>
                        <input type="text" id="name" name="name">
                        <label for="phone">Phone Number:</label>
                        <input type="tel" id="phone" name="phone">
                        <label for="price">Price:</label>
                        <input type="number" id="price" name="price">
                        <label for="image">Image path:</label>
                        <input type="text" id="image" name="image">
                    </div>
                    <div id="extra-fields">
                        <label for="capacity">Capacity:</label>
                        <input type="number" id="capacity" name="capacity">
                        <label for="location">Location:</label>
                        <input type="text" id="location" name="location">
                    </div>
                    <br>
                    <button type="submit" class="btn">Submit</button>
                </form>
            </div>
        </div>
        
        <div id="completedEventsContainer" class="events-container" style="display: none;">
            <center><h2>Completed Events</h2></center>
            <table id="completedEventsTable">
                <thead>
                    <tr>
                        <th>Event Name</th>
                        <th>Date</th>
                        <th>User</th>
                        <th>Admin</th>
                        <th>Venue</th>
                        <th>Catering</th>
                        <th>Studio</th>
                    </tr>
                </thead>
                <tbody id="completedEventsList">
                    <!-- Event rows will be inserted here -->
                </tbody>
            </table>
        </div>

        <div id="UpcomingEventsContainer" class="events-container" style="display: none;">
            <center><h2>Upcoming Events</h2></center>
            <table id="UpcomingEventsTable">
                <thead>
                    <tr>
                        <th>Event Name</th>
                        <th>Date</th>
                        <th>User</th>
                        <th>Admin</th>
                        <th>Venue</th>
                        <th>Catering</th>
                        <th>Studio</th>
                    </tr>
                </thead>
                <tbody id="UpcomingEventsList">
                    <!-- Event rows will be inserted here -->
                </tbody>
            </table>
        </div>
    </section>

    <section class="footer">
        <div class="box-container">
            <div class="box">
                <h3>Quick Links</h3>
                <a href="#">Home</a>
                <a href="#">About</a>
                <a href="#">Events</a>
                <a href="#">Review</a>
                <a href="#">Contact</a>
            </div>
            <div class="box">
                <h3>Extra Links</h3>
                <a href="#">My Account</a>
                <a href="#">My Orders</a>
            </div>
            <div class="box">
                <h3>Locations</h3>
                <a href="#">Chennai</a>
                <a href="#">Madurai</a>
                <a href="#">Coimbatore</a>
                <a href="#">Trichy</a>
            </div>
            <div class="box">
                <h3>Contact Info </h3>
                <a href="#">+91 9876543210</a>
                <a href="#">dreamscape@gmail.com</a>
                <a href="#">TamilNadu, India - 400104</a>
            </div>
            <div class="credit">Created by <span>dreamscape</span> | All rights reserved </div>
        </div>
    </section>

    <div class="profile-card" id="profile">
        <div class="container">
            <div class="close">
                <button><i class="fas fa-times close-icon" id="close" onclick="closeprof()"></i></button>
            </div>
        </div>
        <div class="profile-header">
            <!-- Profile header content will be injected here -->
        </div>
        <div class="profile-details">
            <div class="lmk">
                <!-- Profile details content will be injected here -->
            </div>
        </div>
        <div class="footer">
            <a href="#"><img src="./images/fb.gif" alt="Facebook"></a>
            <a href="#"><img src="./images/twitter.gif"></a>
            <a href="#"><img src="./images/lk.gif" alt="LinkedIn"></a>
        </div>
    </div>

    <script>
      function disp() {
    fetch('/admin-data')
        .then(response => response.json())
        .then(data => {
            console.log('Admin Data:', data); // Log the data to verify the structure

            if (Array.isArray(data) && data.length > 0) {
                const adminData = data[0]; // Get the first admin data object

                // Ensure image path is defined, and set to a default image if not
                const imagePath = adminData.image ? adminData.image.replace(/\\/g, '/') : './images/default-image.jpg';

                // Update profile header
                const profileHeader = document.querySelector('.profile-header');
                profileHeader.innerHTML = `
                    <img src="${adminData.image.replace('C:\\Users\\admin\\Documents\\DBMS PROJECT\\public\\', '')}" alt="${adminData.user_name}">
                    <h2>${adminData.name || 'N/A'}</h2>
                    <p>Username: ${adminData.user_name || 'N/A'}</p>
                `;

                // Update profile details
                const profileDetails = document.querySelector('.profile-details .lmk');
                profileDetails.innerHTML = `
                    <p><span>Email:</span> ${adminData.email || 'N/A'}</p>
                    <p><span>Phone:</span> ${adminData.phone || 'N/A'}</p>
                    <p><span>Date of Joining:</span> ${adminData.date_of_joining ? new Date(adminData.date_of_joining).toLocaleDateString() : 'N/A'}</p>
                    <p><span>Date of Birth:</span> ${adminData.date_of_birth ? new Date(adminData.date_of_birth).toLocaleDateString() : 'N/A'}</p>
                    <p><span>Experience:</span> ${adminData.experience || 'N/A'} Years</p>
                    <p><span>Address:</span> ${adminData.address || 'N/A'}</p>
                `;

                // Display the profile card
                var profile = document.getElementById('profile');
                profile.style.display = "block";
            } else {
                console.error('No admin data received');
            }
        })
        .catch(error => {
            console.error('Error fetching admin data:', error);
        });
}
        function closeprof() {
            var profile = document.getElementById('profile');
            profile.style.display = "none";
        }

        document.getElementById('viewCompletedEvents').addEventListener('click', function(event) {
            event.preventDefault();

            // Fetch completed events from the server
            fetch('/completedevents')
                .then(response => response.json())
                .then(data => {
                    // Display the completed events in a table
                    const completedEventsList = document.getElementById('completedEventsList');
                    completedEventsList.innerHTML = ''; // Clear any existing content

                    data.forEach(event => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${event.event_name}</td>
                            <td>${new Date(event.event_date).toLocaleDateString()}</td>
                            <td>${event.user_name}</td>
                            <td>${event.admin_name}</td>
                            <td>${event.venue_name}</td>
                            <td>${event.catering_name}</td>
                            <td>${event.studio_name}</td>
                        `;
                        completedEventsList.appendChild(row);
                    });

                    document.getElementById('completedEventsContainer').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching completed events:', error);
                });
        });

        document.getElementById('viewUpcomingEvents').addEventListener('click', function(event) {
            event.preventDefault();

            // Fetch upcoming events from the server
            fetch('/upcomingevents')
                .then(response => response.json())
                .then(data => {
                    // Display the upcoming events in a table
                    const upcomingEventsList = document.getElementById('UpcomingEventsList');
                    upcomingEventsList.innerHTML = ''; // Clear any existing content

                    data.forEach(event => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${event.event_name}</td>
                            <td>${new Date(event.event_date).toLocaleDateString()}</td>
                            <td>${event.user_name}</td>
                            <td>${event.admin_name}</td>
                            <td>${event.venue_name}</td>
                            <td>${event.catering_name}</td>
                            <td>${event.studio_name}</td>
                        `;
                        upcomingEventsList.appendChild(row);
                    });

                    document.getElementById('UpcomingEventsContainer').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching upcoming events:', error);
                });
        });

        function showAvailabilitiesPopup() {
            var modal = document.getElementById('availabilitiesModal');
            modal.style.display = "block";
        }

        function closeAvailabilitiesPopup() {
            var modal = document.getElementById('availabilitiesModal');
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            var modal = document.getElementById('availabilitiesModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function handleAvailabilityChange() {
            var availability = document.getElementById('availability').value;
            var commonFields = document.getElementById('common-fields');
            var extraFields = document.getElementById('extra-fields');

            if (availability === 'studio') {
                commonFields.style.display = 'block';
                extraFields.style.display = 'none';
            } else {
                commonFields.style.display = 'block';
                extraFields.style.display = 'block';
            }
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            handleAvailabilityChange();
        });
    </script>
</body>
</html>
